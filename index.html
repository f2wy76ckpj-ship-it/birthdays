<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ðŸŽ‚ Birthday Corner</title>
<meta name="viewport" content="width=515,height=302,initial-scale=1.0,maximum-scale=1.0">
<style>
  :root { 
    --accent:#F36C21; 
    --bg:#fff; 
    --card:#fffefc; 
    --text:#2c3e50; 
  }

  html,body{
    width:515px; height:302px; margin:0; padding:0;
    background:var(--bg);
    font-family:Khula, Arial, sans-serif; color:var(--text);
    display:flex; flex-direction:column; align-items:center; justify-content:flex-start;
    overflow:hidden; position:relative;
  }

  h1{ 
    color:var(--accent); 
    font-size:22px; 
    margin:8px 0 4px 0; 
    text-align:center; 
    font-weight:600;
  }

  .card{
    width:95%; 
    flex:1;
    background:var(--card); 
    border-radius:14px;
    box-shadow:0 2px 4px rgba(0,0,0,.08); 
    padding:6px 10px;
    display:flex; flex-direction:column; align-items:center; justify-content:center; 
    text-align:center;
  }

  table{ 
    border-collapse:collapse; 
    width:100%; 
    font-weight:400;
    transition:font-size 0.3s ease;
  }

  th,td{ 
    padding:2px 4px; 
    font-weight:400;
  }

  th{ 
    color:var(--accent); 
    font-weight:600;
  }

  .empty{ 
    font-size:16px; 
    opacity:.8; 
    animation:pulse 2s infinite; 
  }

  .msg{ 
    font-size:14px; 
    color:var(--accent); 
    font-weight:500; 
    text-align:center; 
    margin-top:4px;
  }

  @keyframes pulse{ 
    0%,100%{transform:scale(1);opacity:.8} 
    50%{transform:scale(1.05);opacity:1} 
  }

  .balloon{ 
    position:absolute; 
    bottom:-80px; 
    font-size:26px; 
    animation:floatUp 6s linear infinite; 
    opacity:.85; 
  }

  @keyframes floatUp{ 
    0%{transform:translateY(0) rotate(0);opacity:1} 
    100%{transform:translateY(-340px) rotate(20deg);opacity:0} 
  }
</style>
</head>
<body>
  <h1>ðŸŽ‚ Birthday Corner</h1>
  <div class="card" id="card">
    <table id="tbl"><tr><td>Loadingâ€¦</td></tr></table>
  </div>
  <div class="msg" id="msg"></div>

<script>
const dataURL = "https://raw.githubusercontent.com/f2wy76ckpj-ship-it/birthdays/main/birthdays.json";

/* JSON format: MM-DD-YYYY */
function parseDate(str){
  const [m, d, y] = str.split("-").map(Number);
  return new Date(y, m - 1, d);
}

function formatDate(d){
  const dd = String(d.getDate()).padStart(2,"0");
  const mm = String(d.getMonth()+1).padStart(2,"0");
  return `${dd}.${mm}.`;
}

async function loadData(){
  try{
    const r = await fetch(dataURL, {cache:"no-store"});
    if(!r.ok) throw new Error();
    return await r.json();
  }catch{
    return [];
  }
}

function launchBalloons(){
  const emojis = ["ðŸŽˆ","ðŸŽ‰","ðŸŽŠ","ðŸ¥³"];
  for(let i=0;i<5;i++){
    const b = document.createElement("div");
    b.className = "balloon";
    b.textContent = emojis[Math.floor(Math.random()*emojis.length)];
    b.style.left = Math.random()*470 + "px";
    b.style.animationDuration = 4 + Math.random()*4 + "s";
    document.body.appendChild(b);
    setTimeout(()=>b.remove(),7000);
  }
}

function adjustFontSize(rowCount){
  const tbl = document.getElementById("tbl");
  let size = 14;
  if(rowCount > 8) size = 11;
  else if(rowCount > 6) size = 12;
  else if(rowCount > 4) size = 13;
  tbl.style.fontSize = size + "px";
}

async function start(){
  const tbl = document.getElementById("tbl");
  const msg = document.getElementById("msg");
  const data = await loadData();

  const now = new Date();
  const thisMonth = now.getMonth();
  const monthName = now.toLocaleString("en-GB", {month:"long"});

  const filtered = data.filter(x=>{
    if(!x.name || !x.date) return false;
    const d = parseDate(x.date);
    return d.getMonth() === thisMonth;
  });

  tbl.innerHTML = "";
  msg.textContent = "";

  if(filtered.length === 0){
    tbl.innerHTML = `<tr><td class="empty">No birthdays in ${monthName} ðŸŽˆ</td></tr>`;
    const cake = document.createElement("div");
    cake.textContent = "ðŸŽ‚";
    cake.style.fontSize = "60px";
    cake.style.position = "absolute";
    cake.style.bottom = "10px";
    cake.style.opacity = "0.15";
    cake.style.animation = "pulse 3s infinite";
    document.body.appendChild(cake);
    return;
  }

  filtered.sort((a,b)=>{
    const da = parseDate(a.date).getDate();
    const db = parseDate(b.date).getDate();
    return da - db;
  });

  const header = document.createElement("tr");
  header.innerHTML = `<th>Name</th><th>Department</th><th>Position</th><th>Date</th>`;
  tbl.appendChild(header);

  filtered.forEach(x=>{
    const d = parseDate(x.date);
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${x.name}</td><td>${x.department||""}</td><td>${x.position||""}</td><td>${formatDate(d)}</td>`;
    tbl.appendChild(tr);
  });

  adjustFontSize(filtered.length);
  msg.textContent = `ðŸŽ‰ Happy birthdays in ${monthName}! ðŸŽ‰`;
  launchBalloons();
}

start();
</script>
</body>
</html>
