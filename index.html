<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ðŸŽ‚ Birthday Corner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  :root {
    --accent:#F36C21;
    --bg:#fff;
    --card:#fffefc;
    --text:#2c3e50;
  }

  html, body {
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    background:var(--bg);
    font-family:Khula, Arial, sans-serif;
    color:var(--text);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    overflow:hidden;
  }

  .wrapper {
    transform-origin: top left;
    width:662px;    /* originalni dizajn */
    height:317px;   /* originalni dizajn */
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
  }

  h1 {
    color:var(--accent);
    font-size:34px;
    margin:0 0 10px 0;
    text-align:center;
    font-weight:700;
  }

  .card {
    width:96%;
    height:74%;
    background:var(--card);
    border-radius:14px;
    box-shadow:0 3px 8px rgba(0,0,0,0.15);
    padding:8px 10px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    text-align:center;
  }

  table {
    border-collapse:collapse;
    width:100%;
    font-size:20px;
    font-weight:600;
  }

  th, td {
    padding:6px 8px;
    text-align:center;
  }

  th {
    color:var(--accent);
    font-size:20px;
    border-bottom:2px solid rgba(0,0,0,0.1);
  }

  td {
    font-size:22px;
  }

  .empty {
    font-size:22px;
    opacity:0.85;
    animation:pulse 3s infinite;
  }

  .msg {
    margin-top:4px;
    font-size:20px;
    color:var(--accent);
    font-weight:700;
    text-align:center;
  }

  @keyframes pulse {
    0%,100% { transform:scale(1); opacity:0.8; }
    50% { transform:scale(1.05); opacity:1; }
  }

  td, th {
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
</style>
</head>
<body>
  <div class="wrapper" id="wrapper">
    <h1>ðŸŽ‚ Birthday Corner</h1>
    <div class="card" id="card">
      <table id="tbl"><tr><td>Loadingâ€¦</td></tr></table>
    </div>
    <div class="msg" id="msg"></div>
  </div>

<script>
const dataURL = "https://raw.githubusercontent.com/f2wy76ckpj-ship-it/birthdays/main/birthdays.json";

/* --- AUTOMATSKO SKALIRANJE --- */
function autoScale(){
  const wrapper = document.getElementById("wrapper");
  const scaleX = window.innerWidth / 662;
  const scaleY = window.innerHeight / 317;
  const scale = Math.min(scaleX, scaleY);
  wrapper.style.transform = `scale(${scale})`;
}
window.addEventListener("resize", autoScale);
window.addEventListener("load", autoScale);

/* --- PARSER & LOGIKA --- */
function parseFlexibleDate(str){
  const [a,b,c] = str.split("-").map(Number);
  const monthFirst = a <= 12;
  const m = monthFirst ? a : b;
  const d = monthFirst ? b : a;
  return new Date(c, m - 1, d);
}

async function loadData(){
  try {
    const r = await fetch(dataURL, {cache:"no-store"});
    if(!r.ok) throw new Error();
    return await r.json();
  } catch {
    return [];
  }
}

function formatDate(d){
  return d.toLocaleDateString("en-GB", {day:"2-digit", month:"2-digit"});
}

async function start(){
  const tbl = document.getElementById("tbl");
  const msg = document.getElementById("msg");
  const data = await loadData();

  const now = new Date();
  const thisMonth = now.getMonth();
  const monthName = now.toLocaleString("en-GB", {month:"long"});

  const filtered = data.filter(x=>{
    if(!x.name || !x.date) return false;
    const d = parseFlexibleDate(x.date);
    return d.getMonth() === thisMonth;
  });

  tbl.innerHTML = "";
  msg.textContent = "";

  if(filtered.length === 0){
    tbl.innerHTML = `<tr><td class="empty">No birthdays in ${monthName} ðŸŽˆ<br>Stay tuned for next month!</td></tr>`;
    const cake = document.createElement("div");
    cake.textContent = "ðŸŽ‚";
    cake.style.fontSize = "90px";
    cake.style.position = "absolute";
    cake.style.bottom = "10px";
    cake.style.opacity = "0.12";
    cake.style.animation = "pulse 3s infinite";
    document.body.appendChild(cake);
    return;
  }

  filtered.sort((a,b)=>{
    const da = parseFlexibleDate(a.date).getDate();
    const db = parseFlexibleDate(b.date).getDate();
    return da - db;
  });

  const header = document.createElement("tr");
  header.innerHTML = `<th>Name</th><th>Department</th><th>Position</th>`;
  tbl.appendChild(header);

  filtered.forEach(x=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${x.name}</td><td>${x.department||""}</td><td>${x.position||""}</td>`;
    tbl.appendChild(tr);
  });

  msg.textContent = `ðŸŽ‰ Happy birthdays in ${monthName}! ðŸŽ‰`;
}

start();
</script>
</body>
</html>
